@startuml server-usecase

' Layout direction
left to right direction

' Actor definitions
:Client 1: as Client1 #aliceblue
:Client 2: as Client2 #aliceblue
:Client 3: as Client3 #aliceblue
:Administrator: as Admin #lightgreen

' System boundary
rectangle "PGS Server System" {
    ' Server Initialization
    package "Server Initialization" {
        usecase "Initialize Server" as UC1
        usecase "Parse Configuration" as UC2
        usecase "Set Socket Options" as UC22
        usecase "Create Dual-Stack Socket" as UC23
        usecase "Set Non-Blocking Mode" as UC24
        usecase "Initialize Cache" as UC29
    }

    ' Server Operation
    package "Server Operation" {
        usecase "Start Server" as UC3
        usecase "Accept New Connection" as UC4
        usecase "Manage Thread Pool" as UC12
        usecase "Manage Epoll Events" as UC13
    }

    ' Request Handling
    package "Request Processing" {
        usecase "Handle HTTP Request" as UC5
        usecase "Route Request" as UC6
        usecase "Handle Asset Request" as UC18
        usecase "Handle Non-Asset Request" as UC19
        usecase "Rate Limit Requests" as UC27
        usecase "Compress Responses" as UC28
        usecase "Check Cache" as UC30
        usecase "Update Cache" as UC31
    }

    ' File Operations
    package "File Operations" {
        usecase "Serve Static File" as UC7
        usecase "Read File Content" as UC15
        usecase "Determine MIME Type" as UC16
        usecase "Send HTTP Response" as UC14
    }

    ' Connection Management
    package "Connection Management" {
        usecase "Manage Connections" as UC8
        usecase "Handle Client Connection" as UC11
        usecase "Close Connection" as UC17
    }

    ' Logging System
    package "Logging" {
        usecase "Log Activities" as UC9
        usecase "Buffer Log Messages" as UC20
        usecase "Flush Log Buffer" as UC21
    }

    ' Server Shutdown
    package "Shutdown Management" {
        usecase "Stop Server" as UC10
        usecase "Handle Signal" as UC25
        usecase "Graceful Shutdown" as UC26
    }
}

' Actor relationships
Client1 --> UC4
Client1 --> UC5
Client2 --> UC4
Client2 --> UC5
Client3 --> UC4
Client3 --> UC5
Admin --> UC1
Admin --> UC3
Admin --> UC10
Admin --> UC25

' Include relationships
UC1 ..> UC2 : <<include>>
UC1 ..> UC22 : <<include>>
UC1 ..> UC23 : <<include>>
UC1 ..> UC24 : <<include>>
UC1 ..> UC29 : <<include>>

UC3 ..> UC4 : <<include>>
UC3 ..> UC12 : <<include>>
UC3 ..> UC13 : <<include>>

UC4 ..> UC11 : <<trigger>>

UC5 ..> UC6 : <<include>>
UC5 ..> UC8 : <<include>>
UC5 ..> UC9 : <<include>>
UC5 ..> UC27 : <<extend>>
UC5 ..> UC28 : <<extend>>
UC5 ..> UC30 : <<include>>

UC6 ..> UC18 : <<include>>
UC6 ..> UC19 : <<include>>

UC7 ..> UC15 : <<include>>
UC7 ..> UC16 : <<include>>
UC7 ..> UC14 : <<include>>
UC7 ..> UC31 : <<include>>

UC8 ..> UC17 : <<extend>>

UC9 ..> UC20 : <<include>>
UC9 ..> UC21 : <<include>>

UC10 ..> UC8 : <<include>>
UC10 ..> UC17 : <<include>>
UC10 ..> UC26 : <<include>>

UC11 ..> UC5 : <<include>>

UC13 ..> UC11 : <<manage>>

UC17 ..> UC9 : <<trigger>>

UC18 ..> UC7 : <<include>>
UC19 ..> UC7 : <<include>>

UC25 ..> UC10 : <<trigger>>

' Notes
note "Handles server initialization including\nsocket setup and configuration loading" as N1
N1 .. UC1

note "Manages concurrent client connections\nand request processing" as N2
N2 .. UC3

note "Implements rate limiting and compression\nas optional request processing steps" as N3
N3 .. UC5

note "Efficiently serves static files with\nproper MIME type detection" as N4
N4 .. UC7

note "Ensures thread safety and proper\nresource cleanup" as N5
N5 .. UC8

note "Implements asynchronous logging\nwith buffering" as N6
N6 .. UC9

note "Ensures graceful shutdown with\nproper resource cleanup" as N7
N7 .. UC10

note "Implements caching mechanism for\nimproved performance" as N8
N8 .. UC30

@enduml